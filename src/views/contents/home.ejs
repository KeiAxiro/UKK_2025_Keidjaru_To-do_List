<div id="tasks-container">
  <% if (!lists.length) { %>
  <article>
    <div class="row">
      <div class="max">
        <h5>Welcome</h5>
        <p>Create New Task Here!</p>
      </div>
    </div>
    <nav>
      <button @click="isModalAdd = true">Create</button>
    </nav>
  </article>
  <% } %> <% var i=0; lists.forEach(element => { i++; %>

  <article
    id="task-<%= element.id %>"
    x-data="{dragIndicator: false}"
    class="task-card surface-container"
  >
    <div x-data="{isMoreOpen<%= i %>: false}">
      <button
        class="circle transparent btn-ignore absolute top-margin right"
        style="z-index: 12121"
        @click="isMoreOpen<%= i %>"
      >
        <i class="material-icons">more_vert</i>
      </button>
      <menu
        x-bind:class="isMoreOpen<%= i %>? 'active':''"
        class="left no-padding border small-round surface-bright"
        style="width: 15rem; margin-right: 1rem"
      >
        <nav class="drawer">
          <a href="/api/auth/logout">
            <i>edit</i>
            <span>Edit</span>
          </a>
        </nav>
      </menu>
    </div>
    <div
      class="task-header bottom-margin"
      @mouseover="dragIndicator = true"
      @mouseout="dragIndicator = false"
    >
      <div
        class="task-drag-indicator absolute top center"
        x-bind:class="dragIndicator? 'active' : ''"
      ></div>

      <h6 class="task-title truncateLists no-margin max">
        <%= element.name %>
      </h6>
      <span class="no-margin grey-text truncateLists">
        <%= element.description %>
      </span>
    </div>
    <div class="task-body">
      <div class="task-content"></div>
      <div class="task-action">
        <a href="#">Edit</a>
        <a href="#">Delete</a>
      </div>
    </div>
  </article>
  <% }) %>
</div>
<script type="module">
  import Swappable from "https://cdn.jsdelivr.net/npm/@shopify/draggable/build/esm/Swappable/Swappable.mjs";

  const tasksContainer = document.querySelector("#tasks-container");

  if (tasksContainer) {
    const swappable = new Swappable(tasksContainer, {
      draggable: ".task-card",
      handle: ".task-header",
      mirror: {
        appendTo: "body",
        constrainDimensions: true,
      },
    });

    // Saat elemen di-drag mendekati elemen lain
    swappable.on("drag:over", (event) => {
      const target = event.over;
      if (target && target.classList.contains("task-card")) {
        target.classList.add("hovered"); // Tambahkan efek glow
      }
    });

    // Saat elemen tidak lagi dekat dengan elemen lain
    swappable.on("drag:out", (event) => {
      const target = event.over;
      if (target && target.classList.contains("task-card")) {
        target.classList.remove("hovered"); // Hapus efek glow
      }
    });

    swappable.on("drag:stop", (event) => {
      const item = event.data.source;
      item.classList.add("dropped");
      setTimeout(() => item.classList.remove("dropped"), 800);
    });

    document.querySelectorAll(".btn-ignore").forEach((button) => {
      ["mousedown", "touchstart"].forEach((eventType) => {
        button.addEventListener(eventType, (event) => {
          event.stopPropagation();
        });
      });
    });
  }
</script>
